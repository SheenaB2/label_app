<!DOCTYPE html>
<html>
<head>
    <title>Video Review</title>
    <style>
        .red-square {
            position: absolute;
            border: 4px solid red; /* Thick border */
            box-sizing: border-box; /* Include border in the element's dimensions */
            pointer-events: none; /* Allow clicks through the div */
        }
        .video-container {
            position: relative;
            display: inline-block;
            width: 1920px; /* Updated width */
            height: 1080px; /* Updated height */
        }
    </style>
</head>
<body>
    <h1>Video Feed with Bounding Boxes</h1>

    {% if video %}
        <p>Reviewing video</p>
        <div class="video-container" id="video-container">
            <video id="video" width="1280" height="720" controls>
                <source src="{{ url_for('static', filename=video.videoname + '.mp4') }}" type="video/mp4">
            </video>
            <div id="redSquare" class="red-square"></div>
        </div>
        <form action="{{ url_for('submit_result') }}" method="post">
            <input type="hidden" name="video_id" value="{{ video.id }}">
            <p>Do the labeled people belong to the same group?</p>
            <button type="submit" name="result" value="yes">Yes</button>
            <button type="submit" name="result" value="no">No</button>
        </form>
    {% else %}
        <p>No videos available for review.</p>
    {% endif %}

    <script type="text/javascript">
        var boxes = {{ box1|tojson }};
        console.log("boxAHHHH",boxes);

        document.addEventListener('DOMContentLoaded', function() {
            var video = document.getElementById('video');
            var redSquare = document.getElementById('redSquare');
            // var box1 = document.getElementById('box1');
            // console.log("boxAHHHH",box1);

            var currentIndex = 0;
            var intervalId;

            function adjustBoundingBox() {
                var box = boxes[currentIndex];
                // console.log("boxA",box);
                var videoRect = video.getBoundingClientRect();
                redSquare.style.top = videoRect.top + window.scrollY + box[1] * (videoRect.height / 720) + 'px';
                redSquare.style.left = videoRect.left + window.scrollX + box[0] * (videoRect.width / 1280) + 'px';
                redSquare.style.width = box[2] * (videoRect.width / 1280) + 'px';
                redSquare.style.height = box[3] * (videoRect.height / 720) + 'px';
                console.log(redSquare.style.top,redSquare.style.left,redSquare.style.width,redSquare.style.height);

                currentIndex = (currentIndex + 1) % boxes.length;
            }

            function startUpdatingBoundingBox() {
                intervalId = setInterval(adjustBoundingBox, 1000/3);
            }

            function stopUpdatingBoundingBox() {
                clearInterval(intervalId);
            }


            video.addEventListener('play', startUpdatingBoundingBox);
            video.addEventListener('pause', stopUpdatingBoundingBox);

            // Adjust bounding box initially
            adjustBoundingBox();

            // Adjust bounding box on fullscreen change
            document.addEventListener('fullscreenchange', adjustBoundingBox);
            document.addEventListener('webkitfullscreenchange', adjustBoundingBox);
            document.addEventListener('mozfullscreenchange', adjustBoundingBox);
            document.addEventListener('msfullscreenchange', adjustBoundingBox);

            // Adjust bounding box on window resize
            window.addEventListener('resize', adjustBoundingBox);
        });
    </script>
</body>
</html>
